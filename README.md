# Machine Learning Algorithms for Predicting the Force of Infection (FOI) of Japanese Encephalitis (JE)
# Summary
This is a follow-up of the previous research done by [Duy M.Nguyen and Quan M.Tran](https://github.com/m2man/JERFOUCRU), with guidance from Dr Hannah Clapham, at the National University of Singapore. 

The project's objective is to predict the FOI of Japanese Encephalitis in various regions. The previous work used Random Forest, while I explored the following methods: 

- PCR
- Random Forest
- Gradient Boosting
- XGBoost

The objective of my work is to provide python code examples of the above methods for future colleagues. We will also compare the methods, explain the hyperparameter tuning and discuss the prediction interval calculation that is less commonly mentioned for machine learning.  

# Data
Data was generated by [Duy M.Nguyen and Quan M.Tran's](https://github.com/m2man/JERFOUCRU) processing steps in Part 1, step 1-7. 

### Input: 
- EM_Imputed_Features_Study.Rds
- Imputed_Features_Endemic.Rds

Location: **Generate/EM_DF/** , **Generate/Inputed_DF/** , in the linked [repository](https://github.com/m2man/JERFOUCRU/tree/master/Training_RF/Generate). 

Next, use the supporting function `Dataframe_To_CSV.R` to convert Rds files into CSV files, in R. This function will store the following result in the **Generate/Python_CSV/** folder.

- EM_Imputed_Features_Study.csv
- Imputed_Features_Endemic.csv 

We will use the above 2 files in our jupyter notebooks. 

### Data description:
26 **X variables**:

- The bioclimatic conditions in the word, derived from rainfall and temperature on a monthly basis: 
'Bio_01', 'Bio_02', 'Bio_03', 'Bio_04', 'Bio_05', 'Bio_06', 'Bio_07', 'Bio_08', 'Bio_09', 'Bio_10', 'Bio_11', 'Bio_12', 'Bio_13', 'Bio_14', 'Bio_15', 'Bio_16', 'Bio_17', 'Bio_18', 'Bio_19'
- The Japanese Encephalitis Vector Distribution: 'VD'
- Rice distribution: 'Rice'
- Livestock distribution: 'Pigs'
- Population density: 'DG_000_014bt_dens'
- Specific age group density: 'Adjusted_Pop_Count_2015'
- Urban/Rural category: 'UR'
- Elevation: 'Elv'

1 **Y variable**: 
- Force of infection (FOI). 

Note that FOI's range is between 0 to 0.5. You can understand this as a kind of probability, but there is an upper limit to the FOI in this dataset. 

Detailed data description can be found [here](https://github.com/m2man/JERFOUCRU/tree/master/Writing%20Documents).

# Method
I showed 4 methods for this problem. 
- PCR
- Random Forest
- Gradient Boosting
- XGBoost

Please check the respective notebook [here](https://github.com/JieSun1990/Predicting_Japanese_Encephalitis/tree/main/Notebooks): **Notebooks/**

### On data thinning
The original file used the entire dataset for training. For demonstration, I have only selected 10% of the training, test and validation set for model building. 
You can comment the below code to run on the whole dataset, with access to HPC. 

```python
Train_Non_NA = Train_Non_NA.sample(frac = 0.1, replace = False, random_state = 1)
Validate_Non_NA = Validate_Non_NA.sample(frac = 0.1, replace = False, random_state = 1)
Test_Non_NA = Test_Non_NA.sample(frac = 0.1, replace = False, random_state = 1)
```
Note that with increasing data, the hyperparameters need to be re-tuned. Results may change. 

# Discussion
XGBoost performed the best among the 4 methods, with the lowest test MSE. However, it is very difficult to obtain suitable prediction interval for XGBoost.

### On correlated features
In general, boosting and bagging produce excellent predictions despite major correlation among variables. This is great advantage of these advanced methods for healthcare-related data science problems, where multicolinearity is common. 

In this problem, a number of features are correlated, as seen from the **Notebooks/JE_PCA.ipynb**.  
![pca.png](https://i.postimg.cc/v8VSqvGZ/pca.png)
